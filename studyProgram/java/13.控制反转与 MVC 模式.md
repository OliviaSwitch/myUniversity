# 控制反转与 MVC 模式

## 控制反转

> 图形用户界面所涉及的细节很多,我们的课程并不打算教授 GUI，但是我们打算借助 GUI 来介绍两个设计思想：控制反转和 MVC 设计模式。
>
> 部件是创建 GUI 的独立部分,比如像按钮、菜单、菜单项、选择框、滑动条、文本框等。Java 类库中有不少现成的部件。
>
> 布局是指如何在屏幕上放置组件。过去,大多数简单的 GUI 系统让程序员在二维坐标系上 指定每个组件的x和y坐标(以像素点为单位),这对于现代的 GUI 系统来说太简单了。因为现代的 GUI 系统还得考虑不同的屏幕分辨率、不同的字体、用户可改变的窗口尺寸,以及许多其他使得布局困难的因素。所以需要有一种能更通用地指定布局的方法,比如,要求“这个部件应该在那个部件的下面“或者”这个部件在窗口改变尺寸时能自动拉伸,但是其他部件保持尺寸不变”。这些可以通过**布局管理器(layout manager)**来实现。
>
> 事件处理是用来响应用户输入的技术。创建了部件并且放在屏幕上合适的位置以后,就得 要有办法来处理诸如用户点击按钮这样的事情。Java 类库处理这类事情的模型是基于事件的。 如果用户激活了一个部件(比如,点击按钮或者选择菜单项),系统就会产生一个事件。应用程序可以收到关于这个事件的通知(以程序的一个方法被调用的方式),然后就可以采取程序该做的动作了。

### 布局管理器

*详见视频

### Swing 的事件机制

> Swing 使用一个非常灵活的模型来处理 GUI 的输入:采用事件监听器的事件处理(event handling)模型。
>
> Swing框架本身以及大部分部件在发生一些情况时会触发相关的事件,而其他的对象也许会对这些事件感兴趣。不同类型的动作会导致不同类型的事件。当点击一个按钮或选中一个菜单项,部件就会触发动作事件;而当点击或移动鼠标时,会触发鼠标事件;当框架被关闭或最小化时,会触发窗口事件。另外还有许多种其他事件。
>
> 所有的对象都可以成为任何这些事件的监听器,而一旦成为监听器,就可以得到这些事件触发的通知。
>
> 实现了众多监听器接口之一的对象就成为一个事件监听器。如果对象实现了恰当的接口, 就可以注册到它想监听的组件上。

### 控制反转

- 由按钮公布一个守听者接口和一对注册/注销函数
- 你的外码实现那个接口，将守听者对象注册在按钮上
- 一旦按钮被按下，就会反过来调用你的守听者对象的某个函数

### 内部类

> 内部类就是指一个类定义在另一个类的内部，从而成为外部类的一个成员。**因此一个类中可以有成员变量、方法，还可以有内部类。**实际上 Java 的内部类可以被称为成员类，内部类实际上是它所在类的成员。所以内部类也就具有和成员变量、成员方法相同的性质。比如，成员方法可以访问私有变量，那么成员类也可以访问私有变量了。也就是说，成员类中的成员方法都可以访问成员类所在类的私有变量。**内部类最重要的特点就是能够访问外部类的所有成员。**

- 在别人里头的类

```java
class OuterClass {   // 外部类
    // ...
    class NestedClass { // 嵌套类，或称为内部类
        // ...
    }
}
```



外部类

```java
class StepListener implements ActionListener {
 private FoxAndRabbit aa;
 public StepListener(FoxAndRabbit a) {
  aa = a;
 }
 public void actionPerformed(ActionEvent e ) {
  aa.step();
  aa.repaint();
 }
}
```



内部类

```java
private class StepListener implements ActionListener {
    public void actionPerformed(ActionEvent e) {
        step();
        frame.repaint();
    }
}
```



匿名类

```java
btnStep.addActionListener(new ActionListener() {
   public void actionPerformed(ActionEvent e) {
    System.out.println("按下啦！");
    step();
    frame.repaint();
   }
  });
```

- 在 `new` 对象的时候给出的类的定义形成了匿名类
- 匿名类可以继承某类也可以实现某接口
- `Swing` 的消息机制广泛使用匿名类

#### 注入反转

- 由按钮公布一个守听者接口和一对注册／注销函数
- 你的代码实现哪个接口，将守听者对象注册在按钮上
- 一旦按钮被按下，就会反过来调用你的守听者对象的某个函数

## MVC 模式

### JTbale

- 用 JTable 类可以以表格的形式显示和编辑数据。
- JTable 类的对象不储存数据，只是数据的表现。

### MVC 设计模式

#### TableModel

显示的对象 <--> `JTable` 对象 <—> Table Model(接口) Object <—> Table Data

#### MVC

- 数据、表现和控制三者分离，各负其责
    - M = Model 模型
        - 保存和维护数据，提供接口让外部修改数据，通知表现需要刷新
    - V = View 表现
        - 从模型获得数据，根据数据画出表现
    - C = Control 控制
        - 从用户得到输入，根据输入调整数据